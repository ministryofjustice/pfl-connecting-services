name: SCA
run-name: SCA ⚡️

on:
  schedule:
    - cron: "0 2 * * *" # Daily at 2 AM UTC

  pull_request:
    branches: ["main", "develop", "release/*"]
    types: [opened, synchronize, reopened]

  push:
    branches: ["**"]

  workflow_dispatch:

permissions: {}

jobs:
  sca:
    name: Software Composition Analysis
    runs-on: ubuntu-latest
    timeout-minutes: 45

    permissions:
      contents: write
      pull-requests: write
      issues: write
      security-events: read
      actions: read

    steps:
      - name: Run SCA with Custom Configuration
        uses: ministryofjustice/devsecops-actions/sca@v1.3.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

          # Dependency Management
          renovate: "true"
          renovate-version: "42.64.1"
          node-version: "24.11.1"

          # Custom Configurations
          dependency-review-config-file: ".github/config/dependency-review.yml"
          trufflehog-config-file: ".github/config/trufflehog.yml"
          codeql-config-file: ".github/config/codeql-config.yml"
          codeql-upload-findings: "always"
          codeql-languages: "javascript,typescript,python"
          dependency-check-suppression-file: "dependency-check-suppression.xml"

          # Container Scanning
          docker-images-file: "docker-images.json"