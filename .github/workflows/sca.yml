# Security composition analysis for dependencies and Docker images
# Scans for vulnerabilities, uploads SARIF results to GitHub Security tab
# Trigger: schedule (daily), pull_request, push, workflow_dispatch | Permissions: contents:write, security-events:write

name: SCA ⚡️
run-name: Software Composition Analysis ⚡️

on:
  schedule:
    - cron: "0 0 * * *"

  pull_request:
    branches: ["main", "develop", "release/*"]
    types: [opened, synchronize, reopened]

  workflow_dispatch:
  branch_protection_rule:

permissions: {}



jobs:
  sca:
    permissions:
      contents: write
      pull-requests: write
      issues: write
      security-events: write
      actions: read

    name: Execute ⚙️
    runs-on: ["ubuntu-latest"]
    timeout-minutes: 45

    steps:
      - name: Repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Node
        uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
        with:
          node-version: ${{ vars.NODE_VERSION }}

      - name: Install
        shell: bash
        run: npm ci --ignore-scripts

      - name: ⚡️ SCA
        uses: ministryofjustice/devsecops-actions/sca@6bc0d6edd646d61efbdf4650943a73c0329dc3b1 # v1.3.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          dependency-review-config-file: "./.github/dependency-review-config.yml"
          dependency-check-suppression-file: "dependency-check-suppression.xml"
